# 引物设计套件 v3.0 - 项目总览

## 🎉 重构完成！

恭喜！您的引物设计工具已完成全面重构升级到 v3.0 版本。

---

## 📁 项目结构

```
Primer_Design_Blast/
├── 启动引物设计套件.bat          # Windows快速启动脚本
│
├── primer_design_suite/           # 🆕 新架构主目录
│   ├── app.py                     # 程序入口
│   ├── README.md                  # 项目说明
│   ├── 使用说明.md                 # 详细使用文档
│   ├── requirements.txt           # Python依赖
│   ├── primer_design_suite.spec   # PyInstaller打包配置
│   │
│   ├── models/                    # 数据模型层
│   │   ├── __init__.py
│   │   ├── primer_params.py       # 引物参数模型（Pydantic验证）
│   │   └── config.py              # 应用配置 + 模板管理器
│   │
│   ├── views/                     # 视图层（UI）
│   │   ├── __init__.py
│   │   ├── main_window.py         # 主窗口（带完整菜单栏）
│   │   └── components/            # UI组件
│   │       ├── __init__.py
│   │       ├── message_box.py     # 美化消息框
│   │       ├── template_dialog.py # 模板管理对话框
│   │       └── settings_dialog.py # 设置对话框
│   │
│   ├── controllers/               # 控制器层（业务逻辑）
│   │   ├── __init__.py
│   │   └── primer_controller.py   # 核心业务控制器
│   │
│   ├── services/                  # 服务层
│   │   ├── __init__.py
│   │   ├── coordinate_service.py  # 坐标转换服务
│   │   └── web_automation_service.py  # Web自动化（页面对象模式）
│   │
│   └── utils/                     # 工具模块
│       ├── __init__.py
│       ├── logger.py              # 日志配置
│       └── resource_utils.py      # 资源路径工具
│
├── web_primer_design_tool_v2.py   # 旧版程序（保留作参考）
│
├── hg19ToHg38/                    # 坐标转换数据
│   └── hg19ToHg38.over.chain
│
├── driver_win10/                  # Windows 10 浏览器驱动
│   ├── msedgedriver.exe
│   └── chromedriver.exe
│
└── driver_win7/                   # Windows 7 浏览器驱动
    ├── msedgedriver.exe
    └── chromedriver.exe
```

---

## ✨ 核心改进

### 1️⃣ 架构升级
- ✅ **MVC设计模式** - 清晰的分层架构
- ✅ **模块化设计** - 每个模块职责单一
- ✅ **依赖注入** - 松耦合，易测试
- ✅ **单例模式** - 浏览器驱动管理

### 2️⃣ 数据验证
- ✅ **Pydantic模型** - 自动参数验证
- ✅ **类型注解** - 代码更安全
- ✅ **友好错误提示** - 详细的验证信息

### 3️⃣ UI功能增强
- ✅ **完整菜单栏**:
  - 📁 文件: 导入/导出坐标
  - ✏️ 编辑: 清空/验证坐标
  - 📋 模板: 保存/加载参数模板
  - 🔧 工具: 驱动更新/设置/关闭浏览器
  - ❓ 帮助: 使用说明/关于

- ✅ **任务控制**:
  - 🚀 开始按钮
  - ⏹️ 停止按钮
  - 📊 进度条
  - 📈 实时统计

- ✅ **进度显示**:
  - 彩色日志输出
  - 时间戳记录
  - 成功/失败统计

### 4️⃣ 服务层优化
- ✅ **坐标服务**:
  - 批量验证
  - 详细错误信息
  - hg19→hg38转换

- ✅ **Web自动化**:
  - 页面对象模式
  - 自动重试机制
  - 浏览器崩溃恢复
  - 单例驱动管理

### 5️⃣ 用户体验
- ✅ **参数模板管理** - 保存常用配置
- ✅ **文件导入导出** - 批量处理更方便
- ✅ **坐标预验证** - 提前发现错误
- ✅ **任务可中断** - 随时停止任务
- ✅ **美化的消息框** - 更友好的提示

### 6️⃣ 错误处理
- ✅ **细化异常类型** - 精准定位问题
- ✅ **自动重试** - 提高成功率
- ✅ **详细日志** - 方便排查问题
- ✅ **优雅降级** - 部分功能失败不影响其他

---

## 🚀 快速开始

### 安装依赖

```bash
cd primer_design_suite
pip install -r requirements.txt
```

### 启动程序

**Windows用户（推荐）:**
```
双击 "启动引物设计套件.bat"
```

**命令行启动:**
```bash
cd primer_design_suite
python app.py
```

---

## 📖 使用流程

### 1. 准备坐标数据

格式示例：
```
chr1 123456
chr2 234567
X 345678
```

### 2. 配置参数

- 方式1: 手动输入参数
- 方式2: 加载已保存的模板
- 方式3: 使用默认值

### 3. 开始设计

1. 点击"开始设计引物"
2. 程序自动验证坐标
3. 转换hg19坐标（如需要）
4. 启动浏览器
5. 自动填写表单
6. 提交任务

### 4. 查看结果

结果会在新的浏览器标签页打开，保持原窗口可继续处理下一组数据。

---

## 🔧 高级功能

### 参数模板

**保存模板:**
- 菜单: 📋 模板 → 💾 保存当前参数为模板
- 输入模板名称
- 下次直接加载

**加载模板:**
- 菜单: 📋 模板 → 📂 加载参数模板
- 选择已保存的模板
- 参数自动填充

### 坐标验证

**预验证:**
- 菜单: ✏️ 编辑 → ✅ 验证坐标
- 显示有效/无效统计
- 列出错误详情

### 任务控制

**中途停止:**
- 点击"⏹️ 停止处理"按钮
- 当前任务完成后停止
- 已处理数据保留

### 文件操作

**导入坐标:**
- 菜单: 📁 文件 → 📂 导入坐标文件
- 支持txt/csv格式

**导出坐标:**
- 菜单: 📁 文件 → 💾 导出当前坐标
- 保存为txt/csv

---

## 📊 技术栈

| 技术 | 用途 | 版本 |
|------|------|------|
| Python | 编程语言 | 3.8+ |
| PyQt5 | GUI框架 | 5.15+ |
| Pydantic | 数据验证 | 1.10+ |
| Selenium | Web自动化 | 4.0+ |
| PyLiftOver | 坐标转换 | 0.4+ |

---

## 🎯 设计模式

### MVC架构

```
用户操作 → View (主窗口)
            ↓
         Controller (业务控制器)
            ↓
         Service (服务层)
            ↓
         Model (数据模型)
```

### 页面对象模式（POM）

```
WebAutomationService
    ↓
PrimerBlastPage (页面对象)
    ↓
Selenium WebDriver
```

### 单例模式

- `WebAutomationService`: 浏览器驱动单例
- `TemplateManager`: 模板管理器单例

---

## 📝 配置文件位置

### Windows:
- **模板**: `C:\Users\{用户名}\.primer_design_suite\templates.json`
- **日志**: `C:\Users\{用户名}\.primer_design_suite\logs\`

### Linux/Mac:
- **模板**: `~/.primer_design_suite/templates.json`
- **日志**: `~/.primer_design_suite/logs/`

---

## 🐛 故障排除

### 常见问题

**1. 程序无法启动**
- 检查Python版本 (需要3.8+)
- 安装所有依赖: `pip install -r requirements.txt`
- 查看日志文件

**2. 浏览器驱动错误**
- 下载对应版本的驱动
- 放入driver_win10或driver_win7目录
- 确保驱动可执行权限

**3. 坐标转换失败**
- 确认chain文件存在
- 检查坐标格式
- 验证坐标范围

**4. 导入pydantic失败**
```bash
pip install pydantic
```

---

## 📦 打包为exe

```bash
cd primer_design_suite
pyinstaller primer_design_suite.spec
```

生成路径: `dist/PrimerDesignSuite/`

---

## 🔮 未来规划

以下功能已预留接口，可继续开发：

- [ ] 驱动自动更新功能
- [ ] 完整的模板管理对话框
- [ ] 高级设置对话框
- [ ] 结果导出功能
- [ ] 批量任务队列
- [ ] 多线程并发处理
- [ ] 深色主题支持
- [ ] 多语言支持

---

## 📄 许可证

MIT License

---

## 🙏 致谢

感谢使用引物设计套件！

如有问题或建议，欢迎反馈！

---

**版本**: 3.0.0  
**更新日期**: 2025-10-23  
**状态**: ✅ 生产就绪

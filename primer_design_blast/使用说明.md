# 引物设计套件 v3.0 - 详细使用说明

## 目录
1. [快速开始](#快速开始)
2. [功能介绍](#功能介绍)
3. [菜单栏说明](#菜单栏说明)
4. [参数说明](#参数说明)
5. [常见问题](#常见问题)
6. [高级功能](#高级功能)

---

## 快速开始

### 安装依赖

```bash
cd primer_design_suite
pip install -r requirements.txt
```

### 启动程序

**方式1: 使用启动脚本（推荐）**
```bash
双击 "启动引物设计套件.bat"
```

**方式2: 命令行启动**
```bash
cd primer_design_suite
python app.py
```

**方式3: 使用打包的exe（如果已打包）**
```bash
双击 PrimerDesignSuite.exe
```

---

## 功能介绍

### 核心功能

1. **批量坐标处理**
   - 一次处理多组染色体坐标
   - 自动验证坐标有效性
   - 支持1-24号染色体及X、Y染色体

2. **自动坐标转换**
   - hg19 → hg38 自动转换
   - 使用LiftOver工具确保准确性

3. **参数模板管理**
   - 保存常用参数配置
   - 快速加载已保存模板
   - 模板导入导出

4. **进度跟踪**
   - 实时显示处理进度
   - 统计成功/失败数量
   - 详细日志记录

5. **错误处理**
   - 自动重试机制
   - 友好的错误提示
   - 任务中断与恢复

---

## 菜单栏说明

### 📁 文件菜单

- **📂 导入坐标文件** (Ctrl+O)
  - 从txt/csv文件导入坐标数据
  - 支持批量导入

- **💾 导出当前坐标** (Ctrl+S)
  - 保存当前输入的坐标
  - 可选择txt或csv格式

- **🚪 退出** (Ctrl+Q)
  - 关闭程序

### ✏️ 编辑菜单

- **🗑️ 清空输入** (Ctrl+D)
  - 清除所有输入的坐标数据

- **✅ 验证坐标** (Ctrl+V)
  - 在提交前验证坐标格式
  - 显示有效/无效统计

### 📋 模板菜单

- **💾 保存当前参数为模板**
  - 将当前参数配置保存为模板
  - 可自定义模板名称

- **📂 加载参数模板**
  - 从已保存的模板中选择加载

- **⚙️ 管理模板**
  - 查看、编辑、删除已保存的模板

### 🔧 工具菜单

- **🔄 更新浏览器驱动**
  - 检查并更新Edge/Chrome驱动
  - 自动匹配浏览器版本

- **⚙️ 设置** (Ctrl+,)
  - 程序高级设置
  - 自定义配置选项

- **🔴 关闭浏览器**
  - 手动关闭自动化浏览器
  - 释放系统资源

### ❓ 帮助菜单

- **📖 使用说明** (F1)
  - 查看详细使用教程

- **ℹ️ 关于**
  - 程序版本信息
  - 功能特性说明

---

## 参数说明

### PCR产物大小
- **最小值**: 50-30000 bp
- **最大值**: 50-30000 bp
- **默认**: 100-1200 bp
- **说明**: PCR扩增产物的长度范围

### Tm值设置
- **最小Tm**: 30-95°C
- **最佳Tm**: 30-95°C
- **最大Tm**: 30-95°C
- **最大差值**: 0-10°C
- **默认**: 58/60/62°C, 差值2°C
- **说明**: 引物熔解温度,影响PCR特异性

### 引物大小
- **最小值**: 10-40 bp
- **最佳值**: 10-40 bp
- **最大值**: 10-40 bp
- **默认**: 18/20/25 bp
- **说明**: 引物长度范围

### 其他参数

**返回引物数**
- 范围: 1-50
- 默认: 10
- 说明: Primer-BLAST返回的引物对数量

**3'端最大GC**
- 范围: 0-5
- 默认: 4
- 说明: 引物3'端允许的最大GC碱基数

**最大连续碱基**
- 范围: 0-10
- 默认: 4
- 说明: 引物中允许的最大连续相同碱基数

**扩展长度**
- **左侧扩展**: 默认800 bp
- **右侧扩展**: 默认800 bp
- 说明: 在目标位点两侧搜索引物的范围

---

## 常见问题

### Q1: 程序无法启动？

**A**: 检查以下几点：
1. Python版本是否为3.8+
2. 是否安装了所有依赖包
3. 查看日志文件获取详细错误信息

### Q2: 浏览器驱动错误？

**A**: 
1. 确认浏览器版本
2. 下载对应版本的驱动
3. 放置在driver_win10或driver_win7目录

### Q3: 坐标转换失败？

**A**:
1. 检查chain文件是否存在
2. 确认坐标格式正确
3. 验证坐标在有效范围内

### Q4: 参数验证失败？

**A**:
- 检查参数是否在允许范围内
- 确保最小值<最佳值<最大值
- 查看错误提示的具体信息

### Q5: 如何查看日志？

**A**:
日志文件位置：
- Windows: `C:\Users\{用户名}\.primer_design_suite\logs\`
- 每天一个日志文件

---

## 高级功能

### 1. 批量坐标文件格式

**标准格式**:
```
chr1 123456
chr2 234567
X 345678
```

**扩展格式** (带注释):
```
chr1 123456  # SNP位点1
chr2 234567  # SNP位点2
```

### 2. 参数模板JSON格式

模板文件: `~/.primer_design_suite/templates.json`

```json
{
  "我的模板1": {
    "pcr_min": 100,
    "pcr_max": 1200,
    "tm_min": 58.0,
    ...
  }
}
```

### 3. 快捷键列表

| 功能 | 快捷键 |
|------|--------|
| 导入文件 | Ctrl+O |
| 导出文件 | Ctrl+S |
| 清空输入 | Ctrl+D |
| 验证坐标 | Ctrl+V |
| 设置 | Ctrl+, |
| 帮助 | F1 |
| 退出 | Ctrl+Q |

### 4. 命令行参数

```bash
python app.py --help          # 显示帮助
python app.py --debug         # 调试模式
python app.py --log-level DEBUG  # 设置日志级别
```

### 5. 打包为exe

```bash
cd primer_design_suite
pyinstaller primer_design_suite.spec
```

生成的exe位于: `dist/PrimerDesignSuite/`

---

## 技术架构

### MVC架构

```
┌─────────────┐
│   Views     │  UI层（PyQt5）
└─────┬───────┘
      │
┌─────▼───────┐
│ Controllers │  业务逻辑控制
└─────┬───────┘
      │
┌─────▼───────┐
│   Models    │  数据模型（pydantic）
└─────┬───────┘
      │
┌─────▼───────┐
│  Services   │  服务层（坐标转换、Web自动化）
└─────────────┘
```

### 核心技术

- **UI框架**: PyQt5
- **数据验证**: Pydantic
- **Web自动化**: Selenium
- **坐标转换**: PyLiftOver
- **日志**: Python logging

---

## 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境设置

```bash
git clone <repository>
cd primer_design_suite
pip install -r requirements.txt
python app.py
```

### 代码规范

- 使用black格式化代码
- 遵循PEP 8
- 添加类型注解
- 编写单元测试

---

## 更新日志

请查看 `README.md` 中的更新日志部分。

---

## 许可证

MIT License

---

## 联系方式

如有任何问题，请通过以下方式联系：
- 提交GitHub Issue
- 发送邮件至开发团队

---

**祝您使用愉快！ 🎉**
